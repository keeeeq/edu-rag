# RAG 核心知识点学习指南

> 📚 **目的**: 系统性学习 RAG (检索增强生成) 的核心技术  
> 🎯 **适合人群**: RAG 初学者、中级开发者  
> ⏱️ **总学时**: 约 8-10 小时

---

## 📖 学习路径

### 🥇 Tier 1: 必须掌握的核心（约 2-3 小时）

| 序号 | 知识点 | 文件 | 重要性 | 学习时间 | 状态 |
|------|--------|------|--------|---------|------|
| 1 | 向量检索与存储 | [01_向量检索与存储.md](./01_向量检索与存储.md) | ⭐⭐⭐⭐⭐ | 30-45分钟 | ✅ 已完成 |
| 2 | RAG 核心流程 | [02_RAG核心流程.md](./02_RAG核心流程.md) | ⭐⭐⭐⭐⭐ | 40-60分钟 | ✅ 已完成 |

### 🥈 Tier 2: 重要优化技术（约 3-4 小时）

| 序号 | 知识点 | 文件 | 重要性 | 学习时间 | 状态 |
|------|--------|------|--------|---------|------|
| 3 | 检索策略选择器 | [03_检索策略选择器.md](./03_检索策略选择器.md) | ⭐⭐⭐⭐ | 30-40分钟 | ✅ 已完成 |
| 4 | 文档分割策略 | [04_文档分割策略.md](./04_文档分割策略.md) | ⭐⭐⭐⭐ | 30-40分钟 | ✅ 已完成 |

### 🥉 Tier 3: 周边功能（约 2-3 小时）

| 序号 | 知识点 | 文件 | 重要性 | 学习时间 | 状态 |
|------|--------|------|--------|---------|------|
| 5 | Prompt 工程 | [05_Prompt工程.md](./05_Prompt工程.md) | ⭐⭐⭐ | 20-30分钟 | ✅ 已完成 |
| 6 | 查询分类器 | [06_查询分类器.md](./06_查询分类器.md) | ⭐⭐ | 20-30分钟 | ✅ 已完成 |
| 7 | 文档加载器 | [07_文档加载器.md](./07_文档加载器.md) | ⭐⭐ | 15-20分钟 | ✅ 已完成 |

### 🏆 Tier 4: 系统集成与优化（约 3-4 小时）⭐⭐⭐⭐⭐

| 序号 | 知识点 | 文件 | 重要性 | 学习时间 | 状态 |
|------|--------|------|--------|---------|------|
| 8 | MySQL与BM25检索 | [08_MySQL与BM25检索.md](./08_MySQL与BM25检索.md) | ⭐⭐⭐⭐⭐ | 40-50分钟 | 🔲 待学习 |
| 9 | 会话管理与历史 | [09_会话管理与历史.md](./09_会话管理与历史.md) | ⭐⭐⭐⭐ | 30-40分钟 | 🔲 待学习 |
| 10 | FastAPI Web服务 | [10_FastAPI Web服务.md](./10_FastAPI Web服务.md) | ⭐⭐⭐⭐ | 40-50分钟 | 🔲 待学习 |
| 11 | 配置管理系统 | [11_配置管理系统.md](./11_配置管理系统.md) | ⭐⭐⭐ | 20-30分钟 | 🔲 待学习 |

---

## 🎯 学习建议

### 阶段 1：理解核心原理（第 1-2 天）

1. 按顺序学习 Tier 1 的两个知识点
2. 重点理解：
   - 向量化的本质
   - 混合检索的原理
   - RAG 的三阶段流程
3. 尝试在代码中找到对应的实现

### 阶段 2：动手实验（第 3-4 天）

1. 修改配置参数，观察效果变化：
   - `chunk_size`（文档切分大小）
   - `k` 和 `m`（检索文档数量）
   - 权重比例（稠密 vs 稀疏）
2. 测试不同的检索策略
3. 修改 Prompt 模板

### 阶段 3：进阶优化（第 5-7 天）

1. 学习 Tier 2 的优化技术
2. 理解四种检索策略的适用场景
3. 学习父子文档切分的设计思想

### 阶段 4：综合应用（第 8-10 天）

1. 学习 Tier 3 的周边功能
2. 尝试自己实现一个简单的 RAG 系统
3. 针对特定场景优化检索效果

---

## 💡 核心概念速查

### 向量检索

- **Embedding**: 文本 → 向量，语义相似 = 向量相近
- **稠密向量**: 1024 维，捕捉语义
- **稀疏向量**: BM25 风格，捕捉关键词
- **混合检索**: 双向量加权融合
- **Rerank**: CrossEncoder 二次打分

### RAG 流程

- **Retrieve**: 从知识库检索相关文档
- **Augment**: 把文档注入到 Prompt
- **Generate**: LLM 基于上下文生成答案

### 检索策略

- **直接检索**: 用原问题检索
- **回溯问题**: 简化问题后检索
- **子查询**: 拆分成多个问题检索
- **HyDE**: 用假设答案检索

### 系统集成 🆕

- **BM25检索**: 关键词匹配,优先级高于RAG
- **回退机制**: BM25无结果 → RAG检索
- **会话管理**: MySQL存储对话历史(最近5轮)
- **流式输出**: WebSocket实时返回答案
- **配置中心**: config.ini统一管理参数

---

## 🛠️ 项目代码结构

```
integrated_qa_system/
├── new_main.py                     ← 🆕 集成系统入口
├── app.py                          ← 🆕 FastAPI Web服务 (知识点10)
├── api.py                          ← 🆕 简化版API
├── config.ini                      ← 配置文件 (知识点11)
├── base/                           ← 🆕 基础模块
│   ├── config.py                   ← 配置管理 (知识点11)
│   └── logger.py                   ← 日志工具
├── mysql_qa/                       ← 🆕 MySQL+BM25模块
│   ├── db/MySQLClient.py           ← MySQL客户端 (知识点8)
│   ├── cache/RedisClient.py        ← Redis缓存 (知识点8)
│   └── retrieval/bm25_search.py    ← BM25检索 (知识点8)
├── rag_qa/                         ← RAG模块
│   ├── core/
│   │   ├── vector_store.py         ← 知识点1
│   │   ├── rag_system.py           ← 知识点2
│   │   ├── strategy_selector.py    ← 知识点3
│   │   ├── prompts.py              ← 知识点5
│   │   └── query_classifier.py     ← 知识点6
│   ├── edu_text_spliter/           ← 知识点4
│   └── edu_document_loaders/       ← 知识点7
└── static/                         ← 🆕 前端界面
    └── index.html                  ← Web UI (知识点10)
```

---

## 📊 学习进度追踪

当前进度：**7/11** (64%)

**Tier 1-3: RAG核心** (已完成)
- ✅ 知识点 1: 向量检索与存储
- ✅ 知识点 2: RAG 核心流程
- ✅ 知识点 3: 检索策略选择器
- ✅ 知识点 4: 文档分割策略
- ✅ 知识点 5: Prompt 工程
- ✅ 知识点 6: 查询分类器
- ✅ 知识点 7: 文档加载器

**Tier 4: 系统集成** (待学习) 🆕
- 🔲 知识点 8: MySQL与BM25检索
- 🔲 知识点 9: 会话管理与历史
- 🔲 知识点 10: FastAPI Web服务
- 🔲 知识点 11: 配置管理系统

---

## 🔗 外部资源

### 必读论文

1. **RAG 原始论文**: "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks" (2020)
2. **BGE-M3**: "BGE M3-Embedding: Multi-Lingual, Multi-Granularity, Multi-Functionality" (2024)

### 推荐视频

1. LangChain RAG 教程
2. Milvus 向量数据库入门

### 开源项目

1. [LangChain](https://github.com/langchain-ai/langchain)
2. [Milvus](https://github.com/milvus-io/milvus)

---

## ❓ 常见问题

### Q1: RAG 和微调（Fine-tuning）有什么区别？

**RAG**:
- ✅ 无需重新训练模型
- ✅ 知识实时更新
- ✅ 答案可追溯
- ❌ 需要向量数据库

**微调**:
- ✅ 知识内化到模型
- ✅ 推理速度快
- ❌ 需要重新训练
- ❌ 知识过时需重新训练

### Q2: 为什么需要混合检索？

单一检索的局限性：
- **仅向量检索**: 专有名词可能理解错
- **仅关键词检索**: 语义查询效果差

混合检索结合两者优势：
- 向量捕捉语义
- 关键词保证精确度

### Q3: Rerank 一定需要吗？

**需要 Rerank 的场景**:
- 检索结果较多（>5个）
- 对准确度要求高
- 有计算资源

**可以跳过 Rerank 的场景**:
- 检索结果很少（≤2个）
- 对速度要求极高
- 计算资源受限

---

## 📝 学习笔记模板

建议在学习每个知识点时，记录：

```markdown
# 知识点X: [名称]

## 核心概念
- 概念1: ...
- 概念2: ...

## 代码位置
- 文件: ...
- 行号: ...

## 关键代码片段
​```python
# 粘贴关键代码
​```

## 我的理解
...

## 疑问点
1. ...
2. ...

## 实验记录
- 实验1: 修改参数X，观察到...
- 实验2: ...
```

---

**开始学习**: [01_向量检索与存储.md](./01_向量检索与存储.md)

**祝学习顺利！** 🚀
