# ğŸ“š æ•™è‚²è¡Œä¸šå‚ç›´é¢†åŸŸ RAG æ™ºèƒ½é—®ç­”ç³»ç»Ÿ

> åŸºäºä¸‰å±‚æ¶æ„çš„æ•™è‚²æœºæ„æ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼Œä¸ºè¯¾ç¨‹å’¨è¯¢åœºæ™¯æä¾›é«˜æ•ˆã€ä½æˆæœ¬ã€é«˜å‡†ç¡®åº¦çš„é—®ç­”æœåŠ¡ã€‚

## ğŸ¯ é¡¹ç›®ç‰¹ç‚¹

- ğŸš€ **ä¸‰å±‚æ£€ç´¢æ¶æ„**ï¼šBM25(0.1ç§’) â†’ RAG(3ç§’) â†’ LLMï¼Œç®€å•é—®é¢˜å¿«é€Ÿå“åº”ï¼Œå¤æ‚é—®é¢˜ç²¾å‡†å›ç­”
- ğŸ’¾ **ä¼šè¯ç®¡ç†**ï¼šMySQL å­˜å‚¨å¯¹è¯å†å²ï¼Œæ”¯æŒå¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ç†è§£
- ğŸŒ **æµå¼è¾“å‡º**ï¼šFastAPI + WebSocket å®ç°å®æ—¶å“åº”ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- âš™ï¸ **é…ç½®åŒ–ç®¡ç†**ï¼šç»Ÿä¸€é…ç½®ä¸­å¿ƒï¼Œæ”¯æŒå¤šç¯å¢ƒéƒ¨ç½²

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·æé—®
    â†“
[ç¬¬0å±‚] BM25ç²¾ç¡®åŒ¹é… (MySQL+Redis) â†’ åŒ¹é…åˆ°åˆ™ç›´æ¥è¿”å› (0.1ç§’)
    â†“ (æœªåŒ¹é…)
[ç¬¬1å±‚] RAGå‘é‡æ£€ç´¢ (Milvus) â†’ Hybrid Search + Reranker
    â†“
[ç¬¬2å±‚] LLMç”Ÿæˆç­”æ¡ˆ (Qwen-Max) â†’ æµå¼è¾“å‡º
    â†“
è¿”å›ç­”æ¡ˆ + ä¿å­˜åˆ°ä¼šè¯å†å² (MySQL)
```

### æ ¸å¿ƒè®¾è®¡

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **ä¸‰å±‚æ¼æ–—** | BM25 æ‹¦æˆª 70% ç®€å•é—®é¢˜ï¼ŒèŠ‚çœ LLM æˆæœ¬ |
| **æ··åˆæ£€ç´¢** | ç¨ å¯†å‘é‡(è¯­ä¹‰) + ç¨€ç–å‘é‡(å…³é”®è¯) äº’è¡¥ |
| **çˆ¶å­æ–‡æ¡£åˆ‡åˆ†** | å­æ–‡æ¡£æ£€ç´¢ç²¾å‡† + çˆ¶æ–‡æ¡£ç”Ÿæˆå®Œæ•´ |

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | ä¼ ç»Ÿ RAG | æœ¬ç³»ç»Ÿ | æå‡ |
|------|---------|--------|------|
| ç®€å•é—®ç­” | 3ç§’ | 0.1ç§’ | **30å€** |
| LLM è°ƒç”¨ | 100% | ~30% | èŠ‚çœ **70%** |
| å¤šè½®å¯¹è¯ | ä¸æ”¯æŒ | æ”¯æŒ | âœ… |

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| å‰ç«¯ | HTML + JavaScript + marked.js |
| åç«¯ | FastAPI + Python 3.8+ |
| å‘é‡åº“ | Milvus 2.3+ |
| æ•°æ®åº“ | MySQL 5.7+ / Redis 6.0+ |
| Embedding | BGE-M3 (ç¨ å¯†+ç¨€ç–) |
| Reranker | BGE-Reranker-Large |
| LLM | é€šä¹‰åƒé—® (Qwen-Max) |
| åˆ†è¯ | jieba + BM25 |

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
integrated_qa_system/
â”œâ”€â”€ app.py               # FastAPI Web æœåŠ¡å…¥å£
â”œâ”€â”€ new_main.py          # é›†æˆç³»ç»Ÿå…¥å£ (IntegratedQASystem)
â”œâ”€â”€ api.py               # API æ¥å£å®šä¹‰
â”œâ”€â”€ config.ini           # ç»Ÿä¸€é…ç½®æ–‡ä»¶
â”œâ”€â”€ base/                # åŸºç¡€é…ç½®æ¨¡å—
â”‚   â””â”€â”€ config.py        # é…ç½®ç®¡ç†å™¨
â”œâ”€â”€ mysql_qa/            # BM25 æ£€ç´¢å±‚
â”‚   â”œâ”€â”€ retrieval/       # BM25 æ£€ç´¢å®ç°
â”‚   â”œâ”€â”€ db/              # MySQL æ•°æ®åº“æ“ä½œ
â”‚   â””â”€â”€ cache/           # Redis ç¼“å­˜
â”œâ”€â”€ rag_qa/              # RAG æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ core/            # æ ¸å¿ƒç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ rag_system.py       # RAG ä¸»æµç¨‹
â”‚   â”‚   â”œâ”€â”€ vector_store.py     # å‘é‡å­˜å‚¨ä¸æ£€ç´¢
â”‚   â”‚   â”œâ”€â”€ prompts.py          # Prompt æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ edu_document_loaders/   # æ–‡æ¡£åŠ è½½å™¨
â”‚   â””â”€â”€ edu_text_spliter/       # æ–‡æ¡£åˆ†å‰²å™¨
â”œâ”€â”€ static/              # å‰ç«¯é™æ€æ–‡ä»¶
â””â”€â”€ learn/               # é¡¹ç›®å­¦ä¹ æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- MySQL 5.7+
- Redis 6.0+
- Milvus 2.3+

### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### é…ç½®

ç¼–è¾‘ `config.ini`ï¼Œé…ç½®æ•°æ®åº“è¿æ¥å’Œ API å¯†é’¥ï¼š

```ini
[mysql]
host = localhost
user = root
password = your_password
database = subjects_kg

[redis]
host = localhost
port = 6379

[milvus]
host = localhost
port = 19530
collection_name = edurag_final

[llm]
model = qwen-plus-2025-12-01
dashscope_api_key = sk-xxxxx
```

### å¯åŠ¨æœåŠ¡

```bash
python app.py
```

è®¿é—® http://localhost:8003 æŸ¥çœ‹ Web ç•Œé¢ã€‚

## ğŸ“– è¯¦ç»†æ–‡æ¡£

æŸ¥çœ‹ `learn/` ç›®å½•è·å–å®Œæ•´çš„æŠ€æœ¯æ–‡æ¡£ï¼š

| æ–‡æ¡£ | å†…å®¹ |
|------|------|
| `project_summary.md` | é¡¹ç›®æ•´ä½“æ¶æ„ä¸æŠ€æœ¯è¯¦è§£ |
| `01_å‘é‡æ£€ç´¢ä¸å­˜å‚¨.md` | Milvusã€BGE-M3ã€Hybrid Search åŸç† |
| `02_RAGæ ¸å¿ƒæµç¨‹.md` | Retrieveâ†’Augmentâ†’Generate å®Œæ•´é“¾è·¯ |
| `03_æ£€ç´¢ç­–ç•¥é€‰æ‹©å™¨.md` | LLM åŠ¨æ€é€‰ç­–ç•¥ã€HyDEã€å­æŸ¥è¯¢åˆ†è§£ |
| `04_æ–‡æ¡£åˆ†å‰²ç­–ç•¥.md` | çˆ¶å­æ–‡æ¡£åˆ‡åˆ†ã€chunk_size è°ƒä¼˜ |
| `05_Promptå·¥ç¨‹.md` | æç¤ºè¯æ¨¡æ¿è®¾è®¡ã€é˜²å¹»è§‰ç­–ç•¥ |
| `06_æŸ¥è¯¢åˆ†ç±»å™¨.md` | BERT å¾®è°ƒã€æ„å›¾è¯†åˆ« |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¨¡å‹æ–‡ä»¶æœªåŒ…å«**ï¼šéœ€è‡ªè¡Œä¸‹è½½ä»¥ä¸‹æ¨¡å‹åˆ° `rag_qa/models/` ç›®å½•ï¼š
   - `bert-base-chinese`
   - `bge-m3`
   - `bge-reranker-large`
   - `nlp_bert_document-segmentation_chinese-base`

2. **æ•°æ®åº“åˆå§‹åŒ–**ï¼šéœ€æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„ï¼Œå‚è€ƒ `learn/project_summary.md`ã€‚

## ğŸ“„ License

MIT License
